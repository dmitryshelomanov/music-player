{"version":3,"sources":["assets/bg.jpg","features/player/components/track-list.js","features/player/components/player.js","lib/analyser.js","features/dropzone/components/zone.js","features/dropzone/model.js","features/player/model.js","ui/global-styles.js","ui/visualize.js","lib/resize.js","pages/player/page.js","pages/dropzone/page.js","index.js"],"names":["List","styled","ul","Item","li","TrackList","list","onTrackClick","activeTrack","map","track","className","classnames","active","onClick","name","lastModified","Wrapepr","div","Player","handlePlay","analyser","updateByteData","getByteFrequencyData","dataArray","play","Promise","res","rej","a","ctx","resume","audio","src","window","URL","createObjectURL","pause","this","Audio","AudioContext","source","createMediaElementSource","createAnalyser","fftSize","Uint8Array","frequencyBinCount","connect","destination","trackEnded","createEvent","addEventListener","Wrapper","Label","label","attrs","htmlFor","InputFile","input","type","id","Dropzone","handleFiles","error","zone","useRef","ref","onDrop","e","dataTransfer","files","onChange","target","multiple","setTrackList","setActiveTrack","validateMusicFx","createEffect","validTypes","i","length","indexOf","Array","from","$trackList","restore","doneData","$validateMusicError","failData","$activeTrack","forward","to","switchTrack","playFx","use","pauseFx","$player","combine","sample","clock","fn","player","direction","index","findIndex","nextIndex","runNextTrack","GlobalStyles","createGlobalStyle","Visualize","useState","innerWidth","canvasWidth","setCanvasWidth","callback","callbackRef","current","useEffect","handler","width","height","innerHeight","removeEventListener","useResize","reqId","undefined","getContext","requestAnimationFrame","tick","clearRect","slice","Math","ceil","forEach","data","yPos","fillStyle","fillRect","stroke","cancelAnimationFrame","Background","bg","PlayerWrapper","PlayerPage","trackList","useStore","file","DropzonePage","history","useHistory","validateMusicError","done","watch","push","App","StrictMode","path","component","exact","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.8f620061.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/bg.418ef879.jpg\";","import React from \"react\";\nimport styled from \"styled-components\";\nimport classnames from \"classnames\";\n\nconst List = styled.ul`\n  width: 100%;\n  margin: 0;\n  padding: 0;\n`;\n\nconst Item = styled.li`\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  list-style: none;\n  flex-direction: column;\n  cursor: pointer;\n  transition: 0.3s;\n  padding: 25px 15px;\n  font-size: 12px;\n  font-weight: 300;\n  border-bottom: 1px solid #e6e6e6;\n\n  &:hover {\n    background: #eb2045;\n    color: #fff;\n  }\n\n  &.active {\n    background: #eb2045;\n    color: #fff;\n  }\n`;\n\nexport function TrackList({ list, onTrackClick, activeTrack }) {\n  return (\n    <List>\n      {list.map((track) => (\n        <Item\n          key={`${track.name}/${track.lastModified}`}\n          className={classnames({ active: activeTrack === track })}\n          onClick={() => {\n            onTrackClick(track);\n          }}\n        >\n          {track.name}\n        </Item>\n      ))}\n    </List>\n  );\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { TrackList } from \"./track-list\";\n\nconst Wrapepr = styled.div`\n  width: 320px;\n  height: 510px;\n  background: #fff;\n  border-radius: 5px;\n  box-shadow: 0 0 20px 0px #6c171e;\n  overflow: hidden;\n`;\n\nexport function Player({ list, handlePlay, activeTrack }) {\n  return (\n    <Wrapepr>\n      <TrackList\n        list={list}\n        onTrackClick={handlePlay}\n        activeTrack={activeTrack}\n      />\n    </Wrapepr>\n  );\n}\n","import { createEvent } from \"effector\";\n\nclass Analyser {\n  constructor() {\n    this.audio = new Audio();\n    this.ctx = new AudioContext();\n    this.source = this.ctx.createMediaElementSource(this.audio);\n    this.analyser = this.ctx.createAnalyser();\n    this.analyser.fftSize = 2048;\n    this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n    this.source.connect(this.analyser);\n    this.analyser.connect(this.ctx.destination);\n    this.trackEnded = createEvent();\n\n    this.audio.addEventListener(\"ended\", () => {\n      this.trackEnded();\n    });\n  }\n\n  updateByteData = () => {\n    this.analyser.getByteFrequencyData(this.dataArray);\n  };\n\n  play = (track) => {\n    return new Promise(async (res, rej) => {\n      try {\n        await this.ctx.resume();\n        this.audio.src = window.URL.createObjectURL(track);\n        this.audio.play();\n        res(true);\n      } catch (error) {\n        rej(error);\n      }\n    });\n  };\n\n  pause = () => {\n    this.audio.pause();\n  };\n}\n\nexport const analyser = new Analyser();\n","import React, { useRef } from \"react\";\nimport styled from \"styled-components\";\nimport classnames from \"classnames\";\n\nconst Wrapper = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  max-width: 480px;\n  width: 100%;\n  height: 125px;\n  border: 2px dashed rgba(121, 183, 125, 1);\n  color: rgb(121, 183, 125);\n  transition: 0.5s;\n  opacity: 0.5;\n\n  &.error {\n    border-color: red;\n    color: red;\n  }\n`;\n\nconst Label = styled.label.attrs({ htmlFor: \"file\" })`\n  color: #03a9f4;\n  margin-top: 5px;\n`;\n\nconst InputFile = styled.input.attrs({ type: \"file\", id: \"file\" })`\n  display: none;\n`;\n\nexport function Dropzone({ handleFiles, error }) {\n  const zone = useRef();\n\n  return (\n    <>\n      <Wrapper\n        className={classnames({ error: !!error })}\n        ref={zone}\n        onDrop={(e) => {\n          handleFiles(e.dataTransfer.files);\n        }}\n      >\n        <p>{error ? error : \"drag & drop music list\"}</p>\n      </Wrapper>\n      <Label>or click here for open files</Label>\n      <InputFile\n        onChange={(e) => {\n          handleFiles(e.target.files);\n        }}\n        multiple\n      />\n    </>\n  );\n}\n","import { restore, createEvent, createEffect, forward } from \"effector\";\n\nexport const setTrackList = createEvent();\nexport const setActiveTrack = createEvent();\n\nexport const validateMusicFx = createEffect(\n  (files) =>\n    new Promise((res, rej) => {\n      const validTypes = [\"audio/mp3\", \"audio/mp4\", \"audio/mpeg\"];\n\n      for (let i = 0; i < files.length; i++) {\n        if (validTypes.indexOf(files[i].type) === -1) {\n          rej(\"has invalid type of files\");\n          break;\n        }\n      }\n\n      res(Array.from(files));\n    })\n);\n\nexport const $trackList = restore(validateMusicFx.doneData, []);\nexport const $validateMusicError = restore(validateMusicFx.failData, null);\nexport const $activeTrack = restore(setActiveTrack, null);\n\nforward({ from: setTrackList, to: validateMusicFx });\n","import { createEffect, createEvent, forward, sample, combine } from \"effector\";\nimport { analyser } from \"../../lib/analyser\";\nimport { $trackList, $activeTrack, setActiveTrack } from \"../dropzone\";\n\nexport const play = createEvent();\nexport const pause = createEvent();\nexport const switchTrack = createEvent();\n\nexport const playFx = createEffect().use(analyser.play);\nconst pauseFx = createEffect().use(analyser.pause);\n\nexport const $player = combine($trackList, $activeTrack, (list, active) => ({\n  list,\n  active,\n}));\n\nfunction runNextTrack({ list, active }, direction = \"next\") {\n  const index = list.findIndex((track) => track === active);\n  const nextIndex = direction === \"next\" ? index + 1 : index - 1;\n\n  return index === -1 || !list[nextIndex] ? list[0] : list[nextIndex];\n}\n\nforward({\n  from: play,\n  to: [setActiveTrack, playFx],\n});\n\nforward({\n  from: pause,\n  to: pauseFx,\n});\n\nforward({\n  from: analyser.trackEnded,\n  to: switchTrack,\n});\n\nsample({\n  source: $player,\n  clock: switchTrack,\n  fn: (player, direction) => runNextTrack(player, direction),\n  target: play,\n});\n","import { createGlobalStyle } from \"styled-components\";\n\nexport const GlobalStyles = createGlobalStyle`\n  body {\n    color: #0B0B0B;\n    font-family: \"Roboto Mono\", monospace;\n    text-rendering: optimizeLegibility;\n    -webkit-font-smoothing: antialiased;\n    width: 100vw;\n    height: 100vh;\n    margin: 0;\n    padding: 0;\n    overflow: hidden;\n  }\n\n  #root {\n    width: 100%;\n    height: 100%;\n  }\n\n  audio {\n    position: absolute;\n    z-index: 5;\n    top: 0;\n    left: 0\n  }\n`;\n","import React, { useRef, useEffect, useState } from \"react\";\nimport styled from \"styled-components\";\nimport { analyser } from \"../lib/analyser\";\nimport { useResize } from \"../lib/resize\";\n\nconst Wrapper = styled.div`\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  background: transparent;\n  z-index: -1;\n  display: flex;\n  align-items: flex-end;\n\n  > svg {\n    width: 100%;\n  }\n`;\n\nexport function Visualize() {\n  const ref = useRef();\n  const [canvasWidth, setCanvasWidth] = useState(window.innerWidth);\n\n  useResize(({ width }) => {\n    setCanvasWidth(width);\n  });\n\n  useEffect(() => {\n    let reqId = undefined;\n    const chartMaxHeigth = 500;\n    const chartWidth = 4;\n    const ctx = ref.current.getContext(\"2d\");\n\n    ref.current.height = chartMaxHeigth;\n    ref.current.width = canvasWidth;\n\n    function tick() {\n      analyser.updateByteData();\n\n      ctx.clearRect(0, 0, ref.current.width, ref.current.height);\n\n      const dataSlice = Array.from(analyser.dataArray).slice(\n        0,\n        Math.ceil(canvasWidth / chartWidth)\n      );\n\n      dataSlice.forEach((data, i) => {\n        const yPos = data === 0 ? chartMaxHeigth : data;\n\n        ctx.fillStyle = `rgba(235, 32, ${data}, .9)`;\n        ctx.fillRect(i * chartWidth, yPos, chartWidth, chartMaxHeigth);\n      });\n\n      ctx.stroke();\n\n      reqId = requestAnimationFrame(tick);\n    }\n\n    reqId = requestAnimationFrame(tick);\n\n    return () => {\n      cancelAnimationFrame(reqId);\n    };\n  }, [canvasWidth]);\n\n  return (\n    <Wrapper>\n      <canvas ref={ref} />\n    </Wrapper>\n  );\n}\n","import { useEffect, useRef } from \"react\";\n\nexport function useResize(callback) {\n  const callbackRef = useRef(callback);\n\n  callbackRef.current = callback;\n\n  useEffect(() => {\n    function handler() {\n      callbackRef.current({\n        width: window.innerWidth,\n        height: window.innerHeight,\n      });\n    }\n\n    window.addEventListener(\"resize\", handler);\n\n    return () => {\n      window.removeEventListener(\"resize\", handler);\n    };\n  }, []);\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { useStore } from \"effector-react\";\nimport bg from \"../../assets/bg.jpg\";\nimport { Player, play } from \"../../features/player\";\nimport { $trackList, $activeTrack } from \"../../features/dropzone\";\nimport { Visualize } from \"../../ui\";\n\nconst Background = styled.div`\n  z-index: -2;\n  filter: blur(2px);\n  background: #fff url(${bg}) center center / cover;\n`;\n\nconst PlayerWrapper = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: 100%;\n\n  &:before,\n  &:after,\n  ${Background} {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n  }\n`;\n\nexport function PlayerPage() {\n  const trackList = useStore($trackList);\n  const activeTrack = useStore($activeTrack);\n\n  return (\n    <>\n      <PlayerWrapper>\n        <Background />\n        <Player\n          activeTrack={activeTrack}\n          list={trackList}\n          handlePlay={(file) => {\n            play(file);\n          }}\n        />\n      </PlayerWrapper>\n      <Visualize />\n    </>\n  );\n}\n","import { useStore } from \"effector-react\";\nimport React, { useEffect } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport {\n  Dropzone,\n  validateMusicFx,\n  setTrackList,\n  $validateMusicError,\n} from \"../../features/dropzone\";\n\nconst Wrapper = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100vw;\n  height: 100vh;\n  flex-direction: column;\n`;\n\nexport function DropzonePage() {\n  const history = useHistory();\n  const validateMusicError = useStore($validateMusicError);\n\n  useEffect(() => {\n    return validateMusicFx.done.watch(() => {\n      history.push(\"/player\");\n    });\n  }, [history]);\n\n  return (\n    <Wrapper>\n      <h1>Simple Music Player</h1>\n      <Dropzone handleFiles={setTrackList} error={validateMusicError} />\n    </Wrapper>\n  );\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { HashRouter, Route } from \"react-router-dom\";\nimport { PlayerPage, DropzonePage } from \"./pages\";\nimport { GlobalStyles } from \"./ui\";\n\nfunction App() {\n  return (\n    <React.StrictMode>\n      <GlobalStyles />\n      <HashRouter>\n        <Route path=\"/\" component={DropzonePage} exact />\n        <Route path=\"/player\" component={PlayerPage} />\n      </HashRouter>\n    </React.StrictMode>\n  );\n}\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}