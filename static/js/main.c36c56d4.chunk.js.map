{"version":3,"sources":["assets/bg.jpg","features/player/components/track-list.js","features/player/components/player.js","lib/analyser.js","features/dropzone/components/zone.js","features/dropzone/model.js","features/player/model.js","ui/global-styles.js","ui/visualize.js","pages/player/page.js","pages/dropzone/page.js","index.js"],"names":["List","styled","ul","Item","li","TrackList","list","onTrackClick","activeTrack","map","track","className","classnames","active","onClick","name","Wrapepr","div","Player","handlePlay","analyser","updateByteData","getByteFrequencyData","dataArray","play","Promise","res","rej","a","ctx","resume","audio","src","window","URL","createObjectURL","pause","this","Audio","AudioContext","source","createMediaElementSource","createAnalyser","fftSize","Uint8Array","frequencyBinCount","connect","destination","Wrapper","Label","label","attrs","htmlFor","InputFile","input","type","id","Dropzone","handleFiles","error","zone","useRef","ref","onDrop","e","dataTransfer","files","onChange","target","multiple","setTrackList","createEvent","setActiveTrack","validateMusicFx","createEffect","validTypes","i","length","indexOf","Array","from","$trackList","restore","doneData","$validateMusicError","failData","$activeTrack","forward","to","resumeFx","use","pauseFx","GlobalStyles","createGlobalStyle","Visualize","svg","useEffect","d3","current","selectAll","data","enter","append","attr","d","reqId","undefined","requestAnimationFrame","tick","cancelAnimationFrame","height","Background","bg","PlayerWrapper","PlayerPage","trackList","useStore","file","DropzonePage","history","useHistory","validateMusicError","done","watch","push","App","StrictMode","path","component","exact","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.c36c56d4.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/bg.418ef879.jpg\";","import React from \"react\";\nimport styled from \"styled-components\";\nimport classnames from \"classnames\";\n\nconst List = styled.ul`\n  width: 100%;\n  margin: 0;\n  padding: 0;\n`;\n\nconst Item = styled.li`\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  list-style: none;\n  flex-direction: column;\n  cursor: pointer;\n  /* transition: 0.3s; */\n  padding: 25px 15px;\n  font-size: 12px;\n  font-weight: 300;\n  border-bottom: 1px solid #e6e6e6;\n\n  &:hover {\n    background: #eb2045;\n    color: #fff;\n  }\n\n  &.active {\n    background: #eb2045;\n    color: #fff;\n  }\n`;\n\nexport function TrackList({ list, onTrackClick, activeTrack }) {\n  return (\n    <List>\n      {list.map((track) => (\n        <Item\n          className={classnames({ active: activeTrack === track })}\n          onClick={() => {\n            onTrackClick(track);\n          }}\n        >\n          {track.name}\n        </Item>\n      ))}\n    </List>\n  );\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { TrackList } from \"./track-list\";\n\nconst Wrapepr = styled.div`\n  width: 320px;\n  height: 510px;\n  background: #fff;\n  border-radius: 5px;\n`;\n\nexport function Player({ list, handlePlay, activeTrack }) {\n  return (\n    <Wrapepr>\n      <TrackList\n        list={list}\n        onTrackClick={handlePlay}\n        activeTrack={activeTrack}\n      />\n    </Wrapepr>\n  );\n}\n","class Analyser {\n  constructor() {\n    this.audio = new Audio();\n    this.ctx = new AudioContext();\n    this.source = this.ctx.createMediaElementSource(this.audio);\n    this.analyser = this.ctx.createAnalyser();\n    this.analyser.fftSize = 2048;\n    this.dataArray = new Uint8Array(this.analyser.frequencyBinCount);\n    this.source.connect(this.analyser);\n    this.analyser.connect(this.ctx.destination);\n  }\n\n  updateByteData = () => {\n    this.analyser.getByteFrequencyData(this.dataArray);\n  };\n\n  play = (track) => {\n    return new Promise(async (res, rej) => {\n      try {\n        await this.ctx.resume();\n        this.audio.src = window.URL.createObjectURL(track);\n        this.audio.play();\n        res(true);\n      } catch (error) {\n        rej(error);\n      }\n    });\n  };\n\n  pause = () => {\n    this.audio.pause();\n  };\n}\n\nexport const analyser = new Analyser();\n","import React, { useRef } from \"react\";\nimport styled from \"styled-components\";\nimport classnames from \"classnames\";\n\nconst Wrapper = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  max-width: 480px;\n  width: 100%;\n  height: 125px;\n  border: 2px dashed rgba(121, 183, 125, 1);\n  color: rgb(121, 183, 125);\n  transition: 0.5s;\n  opacity: 0.5;\n\n  &.error {\n    border-color: red;\n    color: red;\n  }\n`;\n\nconst Label = styled.label.attrs({ htmlFor: \"file\" })`\n  color: #03a9f4;\n  margin-top: 5px;\n`;\n\nconst InputFile = styled.input.attrs({ type: \"file\", id: \"file\" })`\n  display: none;\n`;\n\nexport function Dropzone({ handleFiles, error }) {\n  const zone = useRef();\n\n  return (\n    <>\n      <Wrapper\n        className={classnames({ error: !!error })}\n        ref={zone}\n        onDrop={(e) => {\n          handleFiles(e.dataTransfer.files);\n        }}\n      >\n        <p>{error ? error : \"drag & drop music list\"}</p>\n      </Wrapper>\n      <Label>or click here for open files</Label>\n      <InputFile\n        onChange={(e) => {\n          handleFiles(e.target.files);\n        }}\n        multiple\n      />\n    </>\n  );\n}\n","import { restore, createEvent, createEffect, forward } from \"effector-logger\";\n\nexport const setTrackList = createEvent();\nexport const setActiveTrack = createEvent();\n\nexport const validateMusicFx = createEffect(\n  (files) =>\n    new Promise((res, rej) => {\n      const validTypes = [\"audio/mp3\", \"audio/mp4\", \"audio/mpeg\"];\n\n      for (let i = 0; i < files.length; i++) {\n        if (validTypes.indexOf(files[i].type) === -1) {\n          rej(\"has invalid type of files\");\n          break;\n        }\n      }\n\n      res(Array.from(files));\n    })\n);\n\nexport const $trackList = restore(validateMusicFx.doneData, []);\nexport const $validateMusicError = restore(validateMusicFx.failData, null);\nexport const $activeTrack = restore(setActiveTrack, null);\n\nforward({ from: setTrackList, to: validateMusicFx });\n","import { createEffect, createEvent, forward } from \"effector\";\nimport { analyser } from \"../../lib/analyser\";\nimport { setActiveTrack } from \"../dropzone\";\n\nexport const play = createEvent();\nexport const pause = createEvent();\n\nexport const resumeFx = createEffect().use(analyser.play);\nconst pauseFx = createEffect().use(analyser.pause);\n\nforward({\n  from: play,\n  to: [setActiveTrack, resumeFx],\n});\n\nforward({\n  from: pause,\n  to: pauseFx,\n});\n","import { createGlobalStyle } from \"styled-components\";\n\nexport const GlobalStyles = createGlobalStyle`\n  body {\n    color: #0B0B0B;\n    font-family: \"Roboto Mono\", monospace;\n    text-rendering: optimizeLegibility;\n    -webkit-font-smoothing: antialiased;\n    width: 100vw;\n    height: 100vh;\n    margin: 0;\n    padding: 0;\n    overflow: hidden;\n  }\n\n  #root {\n    width: 100%;\n    height: 100%;\n  }\n\n  audio {\n    position: absolute;\n    z-index: 5;\n    top: 0;\n    left: 0\n  }\n`;\n","import React, { useRef, useEffect } from \"react\";\nimport * as d3 from \"d3\";\nimport styled from \"styled-components\";\nimport { analyser } from \"../lib/analyser\";\n\nconst Wrapper = styled.div`\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  height: 100%;\n  background: transparent;\n  z-index: -1;\n  display: flex;\n  align-items: flex-end;\n\n  > svg {\n    width: 100%;\n  }\n`;\n\nexport function Visualize() {\n  const svg = useRef();\n\n  useEffect(() => {\n    d3.select(svg.current)\n      .selectAll(\"rect\")\n      .data(analyser.dataArray)\n      .enter()\n      .append(\"rect\")\n      .attr(\"x\", (d, i) => i * 4)\n      .attr(\"width\", 4);\n  }, []);\n\n  useEffect(() => {\n    let reqId = undefined;\n\n    function tick() {\n      analyser.updateByteData();\n\n      d3.select(svg.current)\n        .selectAll(\"rect\")\n        .data(analyser.dataArray)\n        .attr(\"y\", (d) => 500 - d)\n        .attr(\"height\", (d) => d)\n        .attr(\"fill\", (d) => `rgba(235, 32, ${d}, .9)`);\n\n      reqId = requestAnimationFrame(tick);\n    }\n\n    reqId = requestAnimationFrame(tick);\n\n    return () => {\n      cancelAnimationFrame(reqId);\n    };\n  }, []);\n\n  return (\n    <Wrapper>\n      <svg height=\"500\" ref={svg} />\n    </Wrapper>\n  );\n}\n","import React from \"react\";\nimport styled from \"styled-components\";\nimport { useStore } from \"effector-react\";\nimport bg from \"../../assets/bg.jpg\";\nimport { Player, play } from \"../../features/player\";\nimport { $trackList, $activeTrack } from \"../../features/dropzone\";\nimport { Visualize } from \"../../ui\";\n\nconst Background = styled.div`\n  z-index: -2;\n  filter: blur(2px);\n  background: #fff url(${bg}) center center / cover;\n`;\n\nconst PlayerWrapper = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100%;\n  height: 100%;\n\n  &:before,\n  &:after,\n  ${Background} {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n  }\n`;\n\nexport function PlayerPage() {\n  const trackList = useStore($trackList);\n  const activeTrack = useStore($activeTrack);\n\n  return (\n    <>\n      <PlayerWrapper>\n        <Background />\n        <Player\n          activeTrack={activeTrack}\n          list={trackList}\n          handlePlay={(file) => {\n            play(file);\n          }}\n        />\n      </PlayerWrapper>\n      <Visualize />\n    </>\n  );\n}\n","import { useStore } from \"effector-react\";\nimport React, { useEffect } from \"react\";\nimport { useHistory } from \"react-router-dom\";\nimport styled from \"styled-components\";\nimport {\n  Dropzone,\n  validateMusicFx,\n  setTrackList,\n  $validateMusicError,\n} from \"../../features/dropzone\";\n\nconst Wrapper = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 100vw;\n  height: 100vh;\n  flex-direction: column;\n`;\n\nexport function DropzonePage() {\n  const history = useHistory();\n  const validateMusicError = useStore($validateMusicError);\n\n  useEffect(() => {\n    return validateMusicFx.done.watch(() => {\n      history.push(\"/player\");\n    });\n  }, [history]);\n\n  return (\n    <Wrapper>\n      <h1>Simple Music Player</h1>\n      <Dropzone handleFiles={setTrackList} error={validateMusicError} />\n    </Wrapper>\n  );\n}\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { HashRouter, Route } from \"react-router-dom\";\nimport { PlayerPage, DropzonePage } from \"./pages\";\nimport { GlobalStyles } from \"./ui\";\n\nfunction App() {\n  return (\n    <React.StrictMode>\n      <GlobalStyles />\n      <HashRouter>\n        <Route path=\"/\" component={DropzonePage} exact />\n        <Route path=\"/player\" component={PlayerPage} />\n      </HashRouter>\n    </React.StrictMode>\n  );\n}\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n"],"sourceRoot":""}